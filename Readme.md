# LinkShorter

## Требования к сборке и запуску проекта

Для запуска приложения необходимо:
- JDK 11
- Maven
- БД PostgreSQL 15 (строка подключения к базе данных указывается в application.yaml)

## Инструкции по сборке и запуску

### Запуск основного приложения

1. Склонируйте репозиторий с GitHub:

       git clone https://github.com/Yura-Bulgakov/LinkShorter.git

2. Перейдите в клонированный репозиторий:

       cd LinkShorter\LinkShorterMain

3. Соберите проект с помощью Maven:

       mvn clean package

4. Запустите основное приложение: 

       java -jar target/LinkShorter-0.0.1-SNAPSHOT.jar

### Запуск телеграм бота

1. Перейдите в пакет с модулем Telegram бота:

        cd LinkShorter\LinkShorterBot

2. Соберите проект бота с помощью Maven:

       mvn clean package

3. Запустите приложение телеграм бота:

       java -jar target/LinkShorterBot-0.0.1-SNAPSHOT.jar


## Описание проекта

Данный проект представляет собой сервис по сокращению ссылок, который позволяет пользователям создавать короткие ссылки для длинных URL-адресов. В проекте реализованы две роли: пользователь и администратор.

### Функционал для пользователя

- Создание коротких ссылок для длинных.
- Удаление коротких ссылок, созданных пользователем.
- Просмотр статистики переходов по коротким ссылкам.
- Редактирование профиля.

### Функционал для администратора

- Блокировка пользователей. (по коротким ссылкам заблокированных пользователей нельзя переходить).
- Блокировка длинных ссылок. (по коротким ссылкам, связанным с заблокированными URL адресами нельзя переходить).
- Удаление коротких ссылок.

## Используемые технологии

- Spring Boot 2.7.14
- Java 11
- PostgreSQL
- Spring Data JPA
- Liquibase
- JUnit 5
- GitHub
- Maven
- Thymeleaf
- Bootstrap

## Описание страниц UI

1. **Главная страница**: предоставляет интерфейс для создания короткой ссылки.
2. **Страницы авторизации и регистрации**: позволяют регистрироваться на сайте и получать доступ к пользовательским страницам.
3. **Страница информации о пользователе**: предоставляет информацию о пользователе, дает досутп к редактированию профиля.
4. **Страница просмотра коротких ссылок пользователя**: интерфейс для просмотра и удаления коротких ссылок.
5. **Страница просмотра статистики переходов**: статистика переходов по коротким ссылкам.
6. **Страница управления пользователями**: интерфейс администратора, дает возможность поиска и блокировки пользователей.
7. **Страница управления длинными ссылками**: интерфейс администратора, дает возможность управлять статусом блокировки длинной ссылки.
8. **Страница управления короткими ссылками**: интерфейс адмистратора, дает возможность поиска и удаления коротких ссылок.

## Интеграции

1. **Интеграция с сервисом заблокированных доменных адресов**:
    - Проверка длинных ссылок на наличие в реестре заблокированных доменов.
    - Автоматическая блокировка ссылок при обнаружении в реестре.

2. **Интеграция с Telegram ботом**:
    - Создание временных коротких ссылок через интерфейс Telegram бота.

## Описание контроллеров

### AdminController

- **showUsers**:
    - **Метод**: GET
    - **Путь**: `/admin/users`
    - **Описание**: Получает список пользователей с возможностью фильтрации по идентификатору пользователя и имени пользователя. Возвращает страницу со списком пользователей.

- **showUsersTokens**:
    - **Метод**: GET
    - **Путь**: `/admin/users/token`
    - **Описание**: Получает список коротких ссылок пользователей с возможностью фильтрации по идентификатору пользователя, имени пользователя и токену. Возвращает страницу со списком коротких ссылок пользователей.

- **showLongLinks**:
    - **Метод**: GET
    - **Путь**: `/admin/links`
    - **Описание**: Получает список длинных ссылок с возможностью фильтрации по идентификатору, токену и имени пользователя. Возвращает страницу со списком длинных ссылок.

- **setUserBanStatus**:
    - **Метод**: PATCH
    - **Путь**: `/admin/users/{id}`
    - **Описание**: Изменяет статус блокировки пользователя по заданному идентификатору. Перенаправляет на страницу списка пользователей.

- **deleteShortLink**:
    - **Метод**: DELETE
    - **Путь**: `/admin/users/token/{id}`
    - **Описание**: Удаляет короткую ссылку по заданному идентификатору. Перенаправляет на страницу списка коротких ссылок пользователей.

- **setLinkForbiddenStatus**:
    - **Метод**: PATCH
    - **Путь**: `/admin/links/{id}`
    - **Описание**: Изменяет статус доступности длинной ссылки по заданному идентификатору. Перенаправляет на страницу списка длинных ссылок.

### AuthController

- **loginPage**:
    - **Метод**: GET
    - **Путь**: `/auth/login`
    - **Описание**: Возвращает страницу авторизации.

- **registrationPage**:
    - **Метод**: GET
    - **Путь**: `/auth/registration`
    - **Описание**: Возвращает страницу регистрации.

- **register**:
    - **Метод**: POST
    - **Путь**: `/auth/registration`
    - **Описание**: Регистрирует нового пользователя. После успешной регистрации перенаправляет на страницу авторизации.

### LinkCreationController

- **createToken**:
    - **Метод**: POST
    - **Путь**: `/link/creation/json`
    - **Описание**: Создает короткую ссылку на основе JSON-запроса. Возвращает ответ с информацией о созданном токене.

- **createTokenWithForm**:
    - **Метод**: POST
    - **Путь**: `/link/creation/form`
    - **Описание**: Создает короткую ссылку на основе данных из формы. После успешного создания токена перенаправляет на главную страницу с сообщением об успешном создании.

### MainController

- **showMainPage**:
    - **Метод**: GET
    - **Путь**: `/main/page`
    - **Описание**: Возвращает главную страницу.

### RedirectController

- **redirect**:
    - **Метод**: GET
    - **Путь**: `/r/{token}`
    - **Описание**: Перенаправляет на длинную ссылку по заданному токену.

### UserController

- **showUserInfo**:
    - **Метод**: GET
    - **Путь**: `/user/info`
    - **Описание**: Отображает информацию о текущем пользователе.

- **showEditForm**:
    - **Метод**: GET
    - **Путь**: `/user/edit`
    - **Описание**: Отображает форму для редактирования информации о пользователе.

- **editUser**:
    - **Метод**: PATCH
    - **Путь**: `/user`
    - **Описание**: Редактирует информацию о пользователе.

- **showUserTokens**:
    - **Метод**: GET
    - **Путь**: `/user/tokens`
    - **Описание**: Отображает список коротких ссылок пользователя.

- **deleteUserToken**:
    - **Метод**: DELETE
    - **Путь**: `/user/tokens/{token-id}`
    - **Описание**: Удаляет короткую ссылку пользователя по заданному идентификатору.


## Тестовые пользователи

| ID | Username | Password | Role       | Banned |
|----|----------|----------|------------|--------|
| 1  | admin    | 1        | ROLE_ADMIN | false  |
| 2  | user1    | 1        | ROLE_USER  | false  |
| 3  | user2    | 1        | Role_USER  | true   |


## БОТ

Доступ к боту по ссылке: <https://t.me/jschool_link_shorter_bot>